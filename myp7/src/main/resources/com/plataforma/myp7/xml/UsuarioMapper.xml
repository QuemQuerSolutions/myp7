<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.plataforma.myp7.mapper.UsuarioMapper">

	<resultMap id="usuarioMap" type="com.plataforma.myp7.data.Usuario">
		<id property="idUsuario" 		column="ID_USUARIO"/>
		<result property="razaoSocial"  column="RAZAO_SOCIAL" />
		<result property="email" 		column="USU_EMAIL" />
		<result property="nDocumento" 	column="USU_CNPJ" />
		<result property="ativo" 		column="USU_ATIVO"/>
		<result property="senha" 		column="USU_SENHA"/>
		<result property="tipoUsuario" 	column="TIPOUSUARIO"/>
	</resultMap>

	<sql id="selectUsuario">
		<![CDATA[
			SELECT ID_USUARIO, RAZAO_SOCIAL, USU_EMAIL, 
				   USU_CNPJ, USU_ATIVO, THEME, TIPOUSUARIO
			FROM USU_USUARIO
		  ]]>
	</sql>
	
	<select id="obterTodos" resultMap="usuarioMap">
		<include refid="selectUsuario"/>
	</select>

	<select id="obterPorId" resultMap="usuarioMap">
		<include refid="selectUsuario"/>
		WHERE ID_USUARIO = #{id}
	</select>
	
	<select id="obterPorEmail" resultMap="usuarioMap">
		<include refid="selectUsuario"/>
		WHERE USU_EMAIL = #{email} and USU_ATIVO = 1;
	</select>	
	
	<select id="obterUsuarioComFiltro" resultMap="usuarioMap">
		<include refid="selectUsuario"/>
		WHERE 1=1
		
		<if test="razaoSocial != null">
			AND RAZAO_SOCIAL LIKE #{razaoSocial}
		</if>
		
		<if test="email != null">
			AND USU_EMAIL LIKE #{email} 
		</if>		
	</select>	
	
	<insert id="incluir" keyProperty="ID_USUARIO" keyColumn="ID_USUARIO" useGeneratedKeys="true">
     	INSERT INTO usu_usuario(  razao_social,
            					   usu_cnpj,
            					   USU_EMAIL,
            					   USU_ATIVO,
            					   usu_senha,
            					   TIPOUSUARIO
            					   )
    						VALUES (#{razaoSocial}, 
    								#{nDocumento},
    								#{email}, 
    								'A', 
    								#{senha},
    								#{tipoUsuario}
            						)
     </insert>
	
	<update id="updateTheme">
		UPDATE usu_usuario
		   SET THEME=#{theme}
		WHERE ID_USUARIO=#{idUsuario}
	</update>
	
</mapper>
